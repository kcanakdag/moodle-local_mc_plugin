{"version":3,"file":"analytics.min.js","sources":["../src/analytics.js"],"sourcesContent":["/**\n * Analytics dashboard module.\n *\n * Uses Mustache templates rendered server-side for consistent display.\n *\n * @module     local_mc_plugin/analytics\n * @copyright  2025 Kerem Can Akdag\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['core/ajax', 'core/notification'], function(Ajax, Notification) {\n    \"use strict\";\n\n    var currentDays = 30;\n    var currentCategory = 'all';\n    var container = null;\n\n    /**\n     * Load analytics data via AJAX and update content.\n     *\n     * @param {number} days Number of days\n     * @param {string} category Event category\n     */\n    var loadData = function(days, category) {\n        currentDays = days;\n        currentCategory = category;\n\n        // Show loading state.\n        var content = container.querySelector('.mc-analytics-content');\n        if (content) {\n            content.style.opacity = '0.5';\n            content.style.pointerEvents = 'none';\n        }\n\n        Ajax.call([{\n            methodname: 'local_mc_plugin_get_analytics',\n            args: {days: days, category: category}\n        }])[0].then(function(data) {\n            // Replace content with server-rendered HTML.\n            if (content) {\n                content.innerHTML = data.html;\n                content.style.opacity = '1';\n                content.style.pointerEvents = '';\n            }\n            updateActiveStates();\n            return null;\n        }).catch(function(error) {\n            Notification.exception(error);\n            if (content) {\n                content.style.opacity = '1';\n                content.style.pointerEvents = '';\n            }\n        });\n    };\n\n    /**\n     * Update active states on filter buttons.\n     */\n    var updateActiveStates = function() {\n        // Update day buttons.\n        container.querySelectorAll('[data-days]').forEach(function(btn) {\n            btn.classList.toggle('active', parseInt(btn.dataset.days) === currentDays);\n        });\n\n        // Update category select.\n        var select = container.querySelector('[data-category-select]');\n        if (select) {\n            select.value = currentCategory;\n        }\n    };\n\n    /**\n     * Initialize the analytics module.\n     *\n     * @param {Object} cfg Configuration\n     * @param {number} cfg.days Initial days\n     * @param {string} cfg.category Initial category\n     */\n    var init = function(cfg) {\n        container = document.getElementById('mc-analytics-container');\n        if (!container) {\n            return;\n        }\n\n        currentDays = cfg.days || 30;\n        currentCategory = cfg.category || 'all';\n\n        // Day filter buttons.\n        container.querySelectorAll('[data-days]').forEach(function(btn) {\n            btn.addEventListener('click', function(e) {\n                e.preventDefault();\n                var days = parseInt(this.dataset.days);\n                if (days !== currentDays) {\n                    loadData(days, currentCategory);\n                }\n            });\n        });\n\n        // Category select.\n        var select = container.querySelector('[data-category-select]');\n        if (select) {\n            select.addEventListener('change', function() {\n                var category = this.value;\n                if (category !== currentCategory) {\n                    loadData(currentDays, category);\n                }\n            });\n        }\n\n        updateActiveStates();\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","Ajax","Notification","currentDays","currentCategory","container","loadData","days","category","content","querySelector","style","opacity","pointerEvents","call","methodname","args","then","data","innerHTML","html","updateActiveStates","catch","error","exception","querySelectorAll","forEach","btn","classList","toggle","parseInt","dataset","select","value","init","cfg","document","getElementById","addEventListener","e","preventDefault","this"],"mappings":";;;;;;;;;AASAA,mCAAO,CAAC,YAAa,sBAAsB,SAASC,KAAMC,kBAGlDC,YAAc,GACdC,gBAAkB,MAClBC,UAAY,KAQZC,SAAW,SAASC,KAAMC,UAC1BL,YAAcI,KACdH,gBAAkBI,aAGdC,QAAUJ,UAAUK,cAAc,yBAClCD,UACAA,QAAQE,MAAMC,QAAU,MACxBH,QAAQE,MAAME,cAAgB,QAGlCZ,KAAKa,KAAK,CAAC,CACPC,WAAY,gCACZC,KAAM,CAACT,KAAMA,KAAMC,SAAUA,aAC7B,GAAGS,MAAK,SAASC,aAEbT,UACAA,QAAQU,UAAYD,KAAKE,KACzBX,QAAQE,MAAMC,QAAU,IACxBH,QAAQE,MAAME,cAAgB,IAElCQ,qBACO,QACRC,OAAM,SAASC,OACdrB,aAAasB,UAAUD,OACnBd,UACAA,QAAQE,MAAMC,QAAU,IACxBH,QAAQE,MAAME,cAAgB,QAQtCQ,mBAAqB,WAErBhB,UAAUoB,iBAAiB,eAAeC,SAAQ,SAASC,KACvDA,IAAIC,UAAUC,OAAO,SAAUC,SAASH,IAAII,QAAQxB,QAAUJ,oBAI9D6B,OAAS3B,UAAUK,cAAc,0BACjCsB,SACAA,OAAOC,MAAQ7B,wBA6ChB,CACH8B,KAnCO,SAASC,QAChB9B,UAAY+B,SAASC,eAAe,2BAKpClC,YAAcgC,IAAI5B,MAAQ,GAC1BH,gBAAkB+B,IAAI3B,UAAY,MAGlCH,UAAUoB,iBAAiB,eAAeC,SAAQ,SAASC,KACvDA,IAAIW,iBAAiB,SAAS,SAASC,GACnCA,EAAEC,qBACEjC,KAAOuB,SAASW,KAAKV,QAAQxB,MAC7BA,OAASJ,aACTG,SAASC,KAAMH,2BAMvB4B,OAAS3B,UAAUK,cAAc,0BACjCsB,QACAA,OAAOM,iBAAiB,UAAU,eAC1B9B,SAAWiC,KAAKR,MAChBzB,WAAaJ,iBACbE,SAASH,YAAaK,aAKlCa"}