define("local_mc_plugin/local/admin/connection_status",["exports","./selectors","./repository","./event_selector"],(function(_exports,_selectors,Repository,EventSelector){var obj;
/**
   * Connection status module for the admin settings page.
   *
   * Handles status display and polling.
   *
   * @module     local_mc_plugin/local/admin/connection_status
   * @copyright  2025 Kerem Can Akdag
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.updateStatusWithError=_exports.testConnection=_exports.init=void 0,_selectors=(obj=_selectors)&&obj.__esModule?obj:{default:obj},Repository=_interopRequireWildcard(Repository),EventSelector=_interopRequireWildcard(EventSelector);let config={},eventInputId="";const updateStatus=(connected,siteName,syncedCount,syncedEvents,message)=>{const statusDot=document.querySelector(_selectors.default.status.dot),statusText=document.querySelector(_selectors.default.status.text),siteNameEl=document.querySelector(_selectors.default.status.siteName),syncStatus=document.querySelector(_selectors.default.status.syncStatus),testResult=document.querySelector(_selectors.default.status.testResult);if(statusDot&&statusText)if(EventSelector.setSyncedEvents(syncedEvents),connected){statusDot.style.color="#28a745",statusText.style.color="#155724",statusText.textContent="Connected",siteName&&siteNameEl&&(siteNameEl.textContent="(".concat(siteName,")")),testResult&&(testResult.innerHTML="");const selectedCount=(()=>{const eventsInput=document.querySelector(_selectors.default.inputs.monitoredEvents);return eventsInput&&eventsInput.value?eventsInput.value.split(",").filter((e=>""!==e.trim())).length:0})(),selectedEvents=(()=>{const eventsInput=document.querySelector(_selectors.default.inputs.monitoredEvents);return eventsInput&&eventsInput.value?eventsInput.value.split(",").map((e=>e.trim())).filter((e=>""!==e)):[]})();if(syncStatus)if(0===syncedCount)syncStatus.innerHTML='<span style="color: #856404;">• Events not synced yet</span>';else if(syncedCount===selectedCount&&syncedEvents){const allMatch=selectedEvents.every((e=>syncedEvents.includes(e)));syncStatus.innerHTML=allMatch?'<span style="color: #155724;">• '.concat(syncedCount," events synced</span>"):'<span style="color: #856404;">• Events changed, click Save & Sync</span>'}else{const diff=selectedCount-syncedCount;syncStatus.innerHTML=diff>0?'<span style="color: #856404;">• '.concat(diff," new event(s) to sync</span>"):'<span style="color: #856404;">• Events changed, click Save & Sync</span>'}eventInputId&&EventSelector.refreshCounter(eventInputId)}else statusDot.style.color="#dc3545",statusText.style.color="#721c24",statusText.textContent="Not connected",siteNameEl&&(siteNameEl.textContent=""),syncStatus&&(syncStatus.textContent=""),testResult&&(testResult.innerHTML='<span style="color: #dc3545;">'.concat(message||"Connection failed","</span>"))},testConnection=async()=>{const statusDot=document.querySelector(_selectors.default.status.dot),statusText=document.querySelector(_selectors.default.status.text),syncStatus=document.querySelector(_selectors.default.status.syncStatus),testResult=document.querySelector(_selectors.default.status.testResult);statusDot&&(statusDot.style.color="#6c757d"),statusText&&(statusText.style.color="#6c757d",statusText.textContent="Checking..."),syncStatus&&(syncStatus.textContent=""),testResult&&(testResult.innerHTML="");try{const data=await Repository.getConnectionStatus(config.syncUrl,config.sesskey);data.connected?updateStatus(!0,data.site_name,data.synced_event_count||0,data.synced_events||[]):data.error?updateStatus(!1,null,0,[],data.error):data.configured?updateStatus(!1,null,0,[],"Click Connect to link your site"):updateStatus(!1,null,0,[],"Click Connect to link your Moodle site")}catch(err){updateStatus(!1,null,0,[],err.message)}};_exports.testConnection=testConnection;_exports.updateStatusWithError=errorMessage=>{const statusDot=document.querySelector(_selectors.default.status.dot),statusText=document.querySelector(_selectors.default.status.text),syncStatus=document.querySelector(_selectors.default.status.syncStatus);statusDot&&(statusDot.style.color="#dc3545"),statusText&&(statusText.style.color="#721c24",statusText.textContent="Sync failed"),syncStatus&&(syncStatus.innerHTML='<span style="color: #dc3545;">• '.concat(errorMessage,"</span>"))};_exports.init=cfg=>{config=cfg,eventInputId=cfg.eventInputId||"",testConnection()}}));

//# sourceMappingURL=connection_status.min.js.map