{"version":3,"names":["define","Selectors","Str","syncedEvents","strings","container","hiddenInput","counterEl","updateValue","selected","querySelectorAll","events","checkbox","document","legacyCheckbox","forEach","cb","eventItem","closest","dataset","class","push","value","join","length","toAdd","filter","evt","includes","toRemove","innerHTML","selectedCount","replace","allSynced","changes","newEvents","removed","textContent","filterEvents","term","lowerTerm","toLowerCase","item","classList","remove","hiddenClass","add","category","cat","selectVisible","selector","checked","deselectVisible","setSyncedEvents","refreshCounter","inputId","init","async","results","get_strings","key","component","loadStrings","querySelector","counter","searchInput","addEventListener","e","target","selectBtn","selectVisibleBtn","deselectBtn","deselectVisibleBtn","categoryTitle","title","style","cursor","nextElementSibling","display","getElementById","legacyCounter","legacySearchInput","legacySelectVisibleBtn","legacyDeselectVisibleBtn","matches"],"sources":["amd/src/local/admin/event_selector.js"],"sourcesContent":["/**\n * Event selector module for the admin settings page.\n *\n * Handles event search, filtering, and bulk selection.\n * Uses data-* attributes from event_selector.mustache template.\n *\n * @module     local_mc_plugin/local/admin/event_selector\n * @copyright  2025 Kerem Can Akdag\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['local_mc_plugin/local/admin/selectors', 'core/str'], function(Selectors, Str) {\n    \"use strict\";\n\n    /** @type {Array} Currently synced events from MoodleConnect */\n    let syncedEvents = [];\n\n    /** @type {Object} Language strings */\n    let strings = {};\n\n    /** @type {HTMLElement|null} Event selector container */\n    let container = null;\n\n    /** @type {HTMLElement|null} Hidden input element */\n    let hiddenInput = null;\n\n    /** @type {HTMLElement|null} Counter element */\n    let counterEl = null;\n\n    /**\n     * Load language strings.\n     *\n     * @returns {Promise<void>}\n     */\n    const loadStrings = async() => {\n        const results = await Str.get_strings([\n            {key: 'event_selected_count', component: 'local_mc_plugin'},\n            {key: 'event_all_synced', component: 'local_mc_plugin'},\n            {key: 'event_new', component: 'local_mc_plugin'},\n            {key: 'event_removed', component: 'local_mc_plugin'},\n        ]);\n\n        strings = {\n            selectedCount: results[0],\n            allSynced: results[1],\n            newEvents: results[2],\n            removed: results[3],\n        };\n    };\n\n    /**\n     * Update the hidden input value with selected events.\n     */\n    const updateValue = () => {\n        if (!hiddenInput || !counterEl) {\n            return;\n        }\n\n        const selected = [];\n        // Use data-action selector for checkboxes from template\n        const checkboxes = container ?\n            container.querySelectorAll(`${Selectors.events.checkbox}:checked`) :\n            document.querySelectorAll(`${Selectors.events.checkbox}:checked, ${Selectors.events.legacyCheckbox}:checked`);\n\n        checkboxes.forEach((cb) => {\n            // Get class from parent mc-event-item's data-class attribute\n            const eventItem = cb.closest(Selectors.events.eventItem);\n            if (eventItem && eventItem.dataset.class) {\n                selected.push(eventItem.dataset.class);\n            }\n        });\n\n        hiddenInput.value = selected.join(',');\n\n        // Update counter with sync status\n        if (syncedEvents.length > 0) {\n            const toAdd = selected.filter((evt) => !syncedEvents.includes(evt)).length;\n            const toRemove = syncedEvents.filter((evt) => !selected.includes(evt)).length;\n\n            if (toAdd === 0 && toRemove === 0) {\n                counterEl.innerHTML = strings.selectedCount.replace('{$a}', selected.length) +\n                    ` <span class=\"text-success\">• ${strings.allSynced}</span>`;\n            } else {\n                const changes = [];\n                if (toAdd > 0) {\n                    changes.push(`${toAdd} ${strings.newEvents}`);\n                }\n                if (toRemove > 0) {\n                    changes.push(`${toRemove} ${strings.removed}`);\n                }\n                counterEl.innerHTML = strings.selectedCount.replace('{$a}', selected.length) +\n                    ` <span class=\"text-warning\">• ${changes.join(', ')}</span>`;\n            }\n        } else {\n            counterEl.textContent = strings.selectedCount.replace('{$a}', selected.length);\n        }\n    };\n\n\n    /**\n     * Filter events based on search term.\n     *\n     * @param {string} term Search term\n     */\n    const filterEvents = (term) => {\n        const lowerTerm = term.toLowerCase();\n        const eventItems = container ?\n            container.querySelectorAll(Selectors.events.eventItem) :\n            document.querySelectorAll(Selectors.events.eventItem);\n\n        eventItems.forEach((item) => {\n            const text = item.textContent.toLowerCase();\n            if (text.includes(lowerTerm)) {\n                item.classList.remove(Selectors.events.hiddenClass);\n            } else {\n                item.classList.add(Selectors.events.hiddenClass);\n            }\n        });\n\n        // Hide empty categories\n        const categories = container ?\n            container.querySelectorAll(Selectors.events.category) :\n            document.querySelectorAll(Selectors.events.category);\n\n        categories.forEach((cat) => {\n            const visible = cat.querySelectorAll(`${Selectors.events.eventItem}:not(.${Selectors.events.hiddenClass})`).length;\n            if (visible === 0) {\n                cat.classList.add(Selectors.events.hiddenClass);\n            } else {\n                cat.classList.remove(Selectors.events.hiddenClass);\n            }\n        });\n    };\n\n    /**\n     * Select all visible checkboxes.\n     */\n    const selectVisible = () => {\n        const selector = `${Selectors.events.eventItem}:not(.${Selectors.events.hiddenClass}) ${Selectors.events.checkbox}`;\n        const checkboxes = container ?\n            container.querySelectorAll(selector) :\n            document.querySelectorAll(selector);\n\n        checkboxes.forEach((cb) => {\n            cb.checked = true;\n        });\n        updateValue();\n    };\n\n    /**\n     * Deselect all visible checkboxes.\n     */\n    const deselectVisible = () => {\n        const selector = `${Selectors.events.eventItem}:not(.${Selectors.events.hiddenClass}) ${Selectors.events.checkbox}`;\n        const checkboxes = container ?\n            container.querySelectorAll(selector) :\n            document.querySelectorAll(selector);\n\n        checkboxes.forEach((cb) => {\n            cb.checked = false;\n        });\n        updateValue();\n    };\n\n    return {\n        /**\n         * Set the synced events array.\n         *\n         * @param {Array} events Array of synced event class names\n         */\n        setSyncedEvents: function(events) {\n            syncedEvents = events || [];\n        },\n\n        /**\n         * Trigger a counter update (called from other modules).\n         *\n         * @param {string} [inputId] The input element ID (for backward compatibility, ignored)\n         */\n        refreshCounter: function(inputId) { // eslint-disable-line no-unused-vars\n            updateValue();\n        },\n\n        /**\n         * Initialize the event selector.\n         *\n         * @param {string} [inputId] The hidden input element ID (for backward compatibility)\n         */\n        init: async function(inputId) {\n            inputId = inputId || null;\n            await loadStrings();\n\n            // Find the event selector container using data-region attribute\n            container = document.querySelector(Selectors.events.container);\n\n            if (container) {\n                // Find elements within container using data-* selectors\n                hiddenInput = container.querySelector(Selectors.events.hiddenInput);\n                counterEl = container.querySelector(Selectors.events.counter);\n\n                // Search input handler\n                const searchInput = container.querySelector(Selectors.events.searchInput);\n                if (searchInput) {\n                    searchInput.addEventListener('keyup', (e) => {\n                        filterEvents(e.target.value);\n                    });\n                }\n\n                // Select/deselect visible buttons\n                const selectBtn = container.querySelector(Selectors.events.selectVisibleBtn);\n                if (selectBtn) {\n                    selectBtn.addEventListener('click', selectVisible);\n                }\n\n                const deselectBtn = container.querySelector(Selectors.events.deselectVisibleBtn);\n                if (deselectBtn) {\n                    deselectBtn.addEventListener('click', deselectVisible);\n                }\n\n                // Category collapse/expand\n                container.querySelectorAll(Selectors.events.categoryTitle).forEach((title) => {\n                    title.style.cursor = 'pointer';\n                    title.addEventListener('click', () => {\n                        const events = title.nextElementSibling;\n                        if (events) {\n                            events.style.display = events.style.display === 'none' ? 'block' : 'none';\n                        }\n                    });\n                });\n            } else if (inputId) {\n                // Fallback to legacy ID-based selectors\n                hiddenInput = document.getElementById(inputId);\n                counterEl = document.querySelector(Selectors.events.legacyCounter(inputId));\n\n                // Search input handler (legacy)\n                const searchInput = document.querySelector(Selectors.events.legacySearchInput(inputId));\n                if (searchInput) {\n                    searchInput.addEventListener('keyup', (e) => {\n                        filterEvents(e.target.value);\n                    });\n                }\n\n                // Select/deselect visible buttons (legacy)\n                const selectBtn = document.querySelector(Selectors.events.legacySelectVisibleBtn(inputId));\n                if (selectBtn) {\n                    selectBtn.addEventListener('click', selectVisible);\n                }\n\n                const deselectBtn = document.querySelector(Selectors.events.legacyDeselectVisibleBtn(inputId));\n                if (deselectBtn) {\n                    deselectBtn.addEventListener('click', deselectVisible);\n                }\n\n                // Category collapse/expand (legacy)\n                document.querySelectorAll(Selectors.events.categoryTitle).forEach((title) => {\n                    title.style.cursor = 'pointer';\n                    title.addEventListener('click', () => {\n                        const events = title.nextElementSibling;\n                        if (events) {\n                            events.style.display = events.style.display === 'none' ? 'block' : 'none';\n                        }\n                    });\n                });\n            }\n\n            // Initial counter update\n            updateValue();\n\n            // Checkbox change handler (delegated to document for dynamic content)\n            document.addEventListener('change', (e) => {\n                // Check for both template and legacy checkbox selectors\n                if (e.target.matches(Selectors.events.checkbox) ||\n                    e.target.matches(Selectors.events.legacyCheckbox)) {\n                    updateValue();\n                }\n            });\n        }\n    };\n});\n"],"mappings":"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","ignoreList":[]}