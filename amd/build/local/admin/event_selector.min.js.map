{"version":3,"file":"event_selector.min.js","sources":["../../../src/local/admin/event_selector.js"],"sourcesContent":["/**\n * Event selector module for the admin settings page.\n *\n * Handles event search, filtering, and bulk selection.\n *\n * @module     local_mc_plugin/local/admin/event_selector\n * @copyright  2025 Kerem Can Akdag\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Selectors from './selectors';\nimport {get_strings as getStrings} from 'core/str';\n\n/** @type {Array} Currently synced events from MoodleConnect */\nlet syncedEvents = [];\n\n/** @type {Object} Language strings */\nlet strings = {};\n\n/**\n * Load language strings.\n *\n * @returns {Promise<void>}\n */\nconst loadStrings = async() => {\n    const results = await getStrings([\n        {key: 'event_selected_count', component: 'local_mc_plugin'},\n        {key: 'event_all_synced', component: 'local_mc_plugin'},\n        {key: 'event_new', component: 'local_mc_plugin'},\n        {key: 'event_removed', component: 'local_mc_plugin'},\n    ]);\n\n    strings = {\n        selectedCount: results[0],\n        allSynced: results[1],\n        newEvents: results[2],\n        removed: results[3],\n    };\n};\n\n/**\n * Get the hidden input element.\n *\n * @param {string} inputId The input element ID\n * @returns {HTMLElement|null}\n */\nconst getHiddenInput = (inputId) => document.getElementById(inputId);\n\n/**\n * Update the hidden input value with selected events.\n *\n * @param {string} inputId The input element ID\n */\nconst updateValue = (inputId) => {\n    const hiddenInput = getHiddenInput(inputId);\n    const counter = document.querySelector(Selectors.events.counter(inputId));\n\n    if (!hiddenInput || !counter) {\n        return;\n    }\n\n    const selected = [];\n    document.querySelectorAll(`${Selectors.events.checkbox}:checked`).forEach((cb) => {\n        selected.push(cb.getAttribute('data-class'));\n    });\n    hiddenInput.value = selected.join(',');\n\n    // Update counter with sync status\n    if (syncedEvents.length > 0) {\n        const toAdd = selected.filter((evt) => !syncedEvents.includes(evt)).length;\n        const toRemove = syncedEvents.filter((evt) => !selected.includes(evt)).length;\n\n        if (toAdd === 0 && toRemove === 0) {\n            counter.innerHTML = strings.selectedCount.replace('{$a}', selected.length) +\n                ` <span style=\"color:#155724;\">• ${strings.allSynced}</span>`;\n        } else {\n            const changes = [];\n            if (toAdd > 0) {\n                changes.push(`${toAdd} ${strings.newEvents}`);\n            }\n            if (toRemove > 0) {\n                changes.push(`${toRemove} ${strings.removed}`);\n            }\n            counter.innerHTML = strings.selectedCount.replace('{$a}', selected.length) +\n                ` <span style=\"color:#856404;\">• ${changes.join(', ')}</span>`;\n        }\n    } else {\n        counter.textContent = strings.selectedCount.replace('{$a}', selected.length);\n    }\n};\n\n/**\n * Filter events based on search term.\n *\n * @param {string} term Search term\n */\nconst filterEvents = (term) => {\n    const lowerTerm = term.toLowerCase();\n\n    document.querySelectorAll(Selectors.events.eventItem).forEach((item) => {\n        const text = item.textContent.toLowerCase();\n        if (text.includes(lowerTerm)) {\n            item.classList.remove(Selectors.events.hiddenClass);\n        } else {\n            item.classList.add(Selectors.events.hiddenClass);\n        }\n    });\n\n    // Hide empty categories\n    document.querySelectorAll(Selectors.events.category).forEach((cat) => {\n        const visible = cat.querySelectorAll(`${Selectors.events.eventItem}:not(.${Selectors.events.hiddenClass})`).length;\n        if (visible === 0) {\n            cat.classList.add(Selectors.events.hiddenClass);\n        } else {\n            cat.classList.remove(Selectors.events.hiddenClass);\n        }\n    });\n};\n\n/**\n * Select all visible checkboxes.\n *\n * @param {string} inputId The input element ID\n */\nconst selectVisible = (inputId) => {\n    document.querySelectorAll(`${Selectors.events.eventItem}:not(.${Selectors.events.hiddenClass}) ${Selectors.events.checkbox}`)\n        .forEach((cb) => {\n            cb.checked = true;\n        });\n    updateValue(inputId);\n};\n\n/**\n * Deselect all visible checkboxes.\n *\n * @param {string} inputId The input element ID\n */\nconst deselectVisible = (inputId) => {\n    document.querySelectorAll(`${Selectors.events.eventItem}:not(.${Selectors.events.hiddenClass}) ${Selectors.events.checkbox}`)\n        .forEach((cb) => {\n            cb.checked = false;\n        });\n    updateValue(inputId);\n};\n\n/**\n * Set the synced events array.\n *\n * @param {Array} events Array of synced event class names\n */\nexport const setSyncedEvents = (events) => {\n    syncedEvents = events || [];\n};\n\n/**\n * Trigger a counter update (called from other modules).\n *\n * @param {string} inputId The input element ID\n */\nexport const refreshCounter = (inputId) => {\n    updateValue(inputId);\n};\n\n/**\n * Initialize the event selector.\n *\n * @param {string} inputId The hidden input element ID\n */\nexport const init = async(inputId) => {\n    await loadStrings();\n\n    // Initial counter update\n    updateValue(inputId);\n\n    // Checkbox change handler\n    document.addEventListener('change', (e) => {\n        if (e.target.classList.contains('event-checkbox')) {\n            updateValue(inputId);\n        }\n    });\n\n    // Category collapse/expand\n    document.querySelectorAll(Selectors.events.categoryTitle).forEach((title) => {\n        title.addEventListener('click', () => {\n            const events = title.nextElementSibling;\n            events.style.display = events.style.display === 'none' ? 'block' : 'none';\n        });\n    });\n\n    // Search input\n    const searchInput = document.querySelector(Selectors.events.searchInput(inputId));\n    if (searchInput) {\n        searchInput.addEventListener('keyup', (e) => {\n            filterEvents(e.target.value);\n        });\n    }\n\n    // Select/deselect visible buttons\n    const selectBtn = document.querySelector(Selectors.events.selectVisibleBtn(inputId));\n    if (selectBtn) {\n        selectBtn.addEventListener('click', () => selectVisible(inputId));\n    }\n\n    const deselectBtn = document.querySelector(Selectors.events.deselectVisibleBtn(inputId));\n    if (deselectBtn) {\n        deselectBtn.addEventListener('click', () => deselectVisible(inputId));\n    }\n};\n"],"names":["syncedEvents","strings","updateValue","inputId","hiddenInput","document","getElementById","getHiddenInput","counter","querySelector","Selectors","events","selected","querySelectorAll","checkbox","forEach","cb","push","getAttribute","value","join","length","toAdd","filter","evt","includes","toRemove","innerHTML","selectedCount","replace","allSynced","changes","newEvents","removed","textContent","async","results","key","component","loadStrings","addEventListener","e","target","classList","contains","categoryTitle","title","nextElementSibling","style","display","searchInput","term","lowerTerm","toLowerCase","eventItem","item","remove","hiddenClass","add","category","cat","filterEvents","selectBtn","selectVisibleBtn","checked","selectVisible","deselectBtn","deselectVisibleBtn","deselectVisible"],"mappings":"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"}