{"version":3,"file":"repository.min.js","sources":["../../../src/local/admin/repository.js"],"sourcesContent":["/**\n * Repository module for AJAX calls to the backend.\n *\n * @module     local_mc_plugin/local/admin/repository\n * @copyright  2025 Kerem Can Akdag\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([], function() {\n    \"use strict\";\n\n    /**\n     * Make a POST request with form data.\n     *\n     * @param {string} url The URL to post to\n     * @param {Object} data The data to send\n     * @returns {Promise<Object>} The JSON response\n     */\n    const postForm = async(url, data) => {\n        const params = new URLSearchParams();\n        Object.entries(data).forEach(([key, value]) => {\n            params.append(key, value);\n        });\n\n        const response = await fetch(url, {\n            method: 'POST',\n            headers: {'Content-Type': 'application/x-www-form-urlencoded'},\n            body: params.toString(),\n        });\n\n        return response.json();\n    };\n\n    return {\n        /**\n         * Initialize the connection flow (get a token).\n         *\n         * @param {string} connectUrl URL to connect.php\n         * @param {string} sesskey Moodle session key\n         * @returns {Promise<Object>} Response with token or error\n         */\n        initConnection: async function(connectUrl, sesskey) {\n            return postForm(connectUrl, {action: 'init', sesskey});\n        },\n\n        /**\n         * Poll the MoodleConnect API for connection status.\n         *\n         * @param {string} apiUrl MoodleConnect API URL\n         * @param {string} token Connection token\n         * @returns {Promise<Object>} Status response\n         */\n        pollConnectionStatus: async function(apiUrl, token) {\n            const response = await fetch(`${apiUrl}/connect/status?token=${encodeURIComponent(token)}`);\n            return response.json();\n        },\n\n        /**\n         * Save credentials to Moodle settings.\n         *\n         * @param {string} saveUrl URL to ajax_save.php\n         * @param {string} sesskey Moodle session key\n         * @param {string} siteKey The site key\n         * @param {string} siteSecret The site secret\n         * @returns {Promise<Object>} Response with success status\n         */\n        saveCredentials: async function(saveUrl, sesskey, siteKey, siteSecret) {\n            return postForm(saveUrl, {\n                action: 'save',\n                sesskey,\n                siteKey: siteKey,\n                siteSecret: siteSecret,\n            });\n        },\n\n        /**\n         * Get connection status from the backend.\n         *\n         * @param {string} syncUrl URL to sync_schema.php\n         * @param {string} sesskey Moodle session key\n         * @returns {Promise<Object>} Status response\n         */\n        getConnectionStatus: async function(syncUrl, sesskey) {\n            return postForm(syncUrl, {action: 'status', sesskey});\n        },\n\n        /**\n         * Save settings via AJAX.\n         *\n         * @param {string} ajaxSaveUrl URL to ajax_save.php\n         * @param {string} sesskey Moodle session key\n         * @param {Object} values Form values to save\n         * @returns {Promise<Object>} Response with success status\n         */\n        saveSettings: async function(ajaxSaveUrl, sesskey, values) {\n            return postForm(ajaxSaveUrl, {action: 'save', sesskey, ...values});\n        },\n\n        /**\n         * Sync events to MoodleConnect.\n         *\n         * @param {string} syncUrl URL to sync_schema.php\n         * @param {string} sesskey Moodle session key\n         * @returns {Promise<Object>} Response with success status and event count\n         */\n        syncEvents: async function(syncUrl, sesskey) {\n            return postForm(syncUrl, {action: 'sync', sesskey});\n        },\n\n        /**\n         * Sync ALL events to MoodleConnect (for initial connection or resync).\n         *\n         * @param {string} syncUrl URL to sync_schema.php\n         * @param {string} sesskey Moodle session key\n         * @returns {Promise<Object>} Response with success status and event count\n         */\n        syncAllEvents: async function(syncUrl, sesskey) {\n            return postForm(syncUrl, {action: 'syncall', sesskey});\n        }\n    };\n});\n"],"names":["define","postForm","async","url","data","params","URLSearchParams","Object","entries","forEach","_ref","key","value","append","fetch","method","headers","body","toString","json","initConnection","connectUrl","sesskey","action","pollConnectionStatus","apiUrl","token","encodeURIComponent","saveCredentials","saveUrl","siteKey","siteSecret","getConnectionStatus","syncUrl","saveSettings","ajaxSaveUrl","values","syncEvents","syncAllEvents"],"mappings":";;;;;;;AAOAA,gDAAO,IAAI,iBAUDC,SAAWC,MAAMC,IAAKC,cAClBC,OAAS,IAAIC,gBACnBC,OAAOC,QAAQJ,MAAMK,SAAQC,WAAEC,IAAKC,YAChCP,OAAOQ,OAAOF,IAAKC,uBAGAE,MAAMX,IAAK,CAC9BY,OAAQ,OACRC,QAAS,gBAAiB,qCAC1BC,KAAMZ,OAAOa,cAGDC,cAGb,CAQHC,eAAgBlB,eAAemB,WAAYC,gBAChCrB,SAASoB,WAAY,CAACE,OAAQ,OAAQD,QAAAA,WAUjDE,qBAAsBtB,eAAeuB,OAAQC,oBAClBZ,gBAASW,wCAA+BE,mBAAmBD,UAClEP,QAYpBS,gBAAiB1B,eAAe2B,QAASP,QAASQ,QAASC,mBAChD9B,SAAS4B,QAAS,CACrBN,OAAQ,OACRD,QAAAA,QACAQ,QAASA,QACTC,WAAYA,cAWpBC,oBAAqB9B,eAAe+B,QAASX,gBAClCrB,SAASgC,QAAS,CAACV,OAAQ,SAAUD,QAAAA,WAWhDY,aAAchC,eAAeiC,YAAab,QAASc,eACxCnC,SAASkC,YAAa,CAACZ,OAAQ,OAAQD,QAAAA,WAAYc,UAU9DC,WAAYnC,eAAe+B,QAASX,gBACzBrB,SAASgC,QAAS,CAACV,OAAQ,OAAQD,QAAAA,WAU9CgB,cAAepC,eAAe+B,QAASX,gBAC5BrB,SAASgC,QAAS,CAACV,OAAQ,UAAWD,QAAAA"}