{"version":3,"names":["define","postForm","async","url","data","params","URLSearchParams","Object","entries","forEach","key","value","append","fetch","method","headers","body","toString","json","initConnection","connectUrl","sesskey","action","pollConnectionStatus","apiUrl","token","encodeURIComponent","saveCredentials","saveUrl","siteKey","siteSecret","getConnectionStatus","syncUrl","saveSettings","ajaxSaveUrl","values","syncEvents"],"sources":["amd/src/local/admin/repository.js"],"sourcesContent":["/**\n * Repository module for AJAX calls to the backend.\n *\n * @module     local_mc_plugin/local/admin/repository\n * @copyright  2025 Kerem Can Akdag\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([], function() {\n    \"use strict\";\n\n    /**\n     * Make a POST request with form data.\n     *\n     * @param {string} url The URL to post to\n     * @param {Object} data The data to send\n     * @returns {Promise<Object>} The JSON response\n     */\n    const postForm = async(url, data) => {\n        const params = new URLSearchParams();\n        Object.entries(data).forEach(([key, value]) => {\n            params.append(key, value);\n        });\n\n        const response = await fetch(url, {\n            method: 'POST',\n            headers: {'Content-Type': 'application/x-www-form-urlencoded'},\n            body: params.toString(),\n        });\n\n        return response.json();\n    };\n\n    return {\n        /**\n         * Initialize the connection flow (get a token).\n         *\n         * @param {string} connectUrl URL to connect.php\n         * @param {string} sesskey Moodle session key\n         * @returns {Promise<Object>} Response with token or error\n         */\n        initConnection: async function(connectUrl, sesskey) {\n            return postForm(connectUrl, {action: 'init', sesskey});\n        },\n\n        /**\n         * Poll the MoodleConnect API for connection status.\n         *\n         * @param {string} apiUrl MoodleConnect API URL\n         * @param {string} token Connection token\n         * @returns {Promise<Object>} Status response\n         */\n        pollConnectionStatus: async function(apiUrl, token) {\n            const response = await fetch(`${apiUrl}/connect/status?token=${encodeURIComponent(token)}`);\n            return response.json();\n        },\n\n        /**\n         * Save credentials to Moodle settings.\n         *\n         * @param {string} saveUrl URL to ajax_save.php\n         * @param {string} sesskey Moodle session key\n         * @param {string} siteKey The site key\n         * @param {string} siteSecret The site secret\n         * @returns {Promise<Object>} Response with success status\n         */\n        saveCredentials: async function(saveUrl, sesskey, siteKey, siteSecret) {\n            return postForm(saveUrl, {\n                action: 'save',\n                sesskey,\n                siteKey: siteKey,\n                siteSecret: siteSecret,\n            });\n        },\n\n        /**\n         * Get connection status from the backend.\n         *\n         * @param {string} syncUrl URL to sync_schema.php\n         * @param {string} sesskey Moodle session key\n         * @returns {Promise<Object>} Status response\n         */\n        getConnectionStatus: async function(syncUrl, sesskey) {\n            return postForm(syncUrl, {action: 'status', sesskey});\n        },\n\n        /**\n         * Save settings via AJAX.\n         *\n         * @param {string} ajaxSaveUrl URL to ajax_save.php\n         * @param {string} sesskey Moodle session key\n         * @param {Object} values Form values to save\n         * @returns {Promise<Object>} Response with success status\n         */\n        saveSettings: async function(ajaxSaveUrl, sesskey, values) {\n            return postForm(ajaxSaveUrl, {action: 'save', sesskey, ...values});\n        },\n\n        /**\n         * Sync events to MoodleConnect.\n         *\n         * @param {string} syncUrl URL to sync_schema.php\n         * @param {string} sesskey Moodle session key\n         * @returns {Promise<Object>} Response with success status and event count\n         */\n        syncEvents: async function(syncUrl, sesskey) {\n            return postForm(syncUrl, {action: 'sync', sesskey});\n        }\n    };\n});\n"],"mappings":";;;;;;;AAOAA,OAAO,GAAI,WACP,aASA,MAAMC,EAAWC,MAAMC,EAAKC,KACxB,MAAMC,EAAS,IAAIC,gBACnBC,OAAOC,QAAQJ,GAAMK,QAAQ,EAAEC,EAAKC,MAChCN,EAAOO,OAAOF,EAAKC,KASvB,aANuBE,MAAMV,EAAK,CAC9BW,OAAQ,OACRC,QAAS,CAAC,eAAgB,qCAC1BC,KAAMX,EAAOY,cAGDC,QAGpB,MAAO,CAQHC,eAAgBjB,eAAekB,EAAYC,GACvC,OAAOpB,EAASmB,EAAY,CAACE,OAAQ,OAAQD,WACjD,EASAE,qBAAsBrB,eAAesB,EAAQC,GAEzC,aADuBZ,MAAM,GAAGW,0BAA+BE,mBAAmBD,OAClEP,MACpB,EAWAS,gBAAiBzB,eAAe0B,EAASP,EAASQ,EAASC,GACvD,OAAO7B,EAAS2B,EAAS,CACrBN,OAAQ,OACRD,UACAQ,QAASA,EACTC,WAAYA,GAEpB,EASAC,oBAAqB7B,eAAe8B,EAASX,GACzC,OAAOpB,EAAS+B,EAAS,CAACV,OAAQ,SAAUD,WAChD,EAUAY,aAAc/B,eAAegC,EAAab,EAASc,GAC/C,OAAOlC,EAASiC,EAAa,CAACZ,OAAQ,OAAQD,aAAYc,GAC9D,EASAC,WAAYlC,eAAe8B,EAASX,GAChC,OAAOpB,EAAS+B,EAAS,CAACV,OAAQ,OAAQD,WAC9C,EAER","ignoreList":[]}