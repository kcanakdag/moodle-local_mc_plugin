{"version":3,"file":"repository.min.js","sources":["../../../src/local/admin/repository.js"],"sourcesContent":["/**\n * Repository module for AJAX calls to the backend.\n *\n * @module     local_mc_plugin/local/admin/repository\n * @copyright  2025 Kerem Can Akdag\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Make a POST request with form data.\n *\n * @param {string} url The URL to post to\n * @param {Object} data The data to send\n * @returns {Promise<Object>} The JSON response\n */\nconst postForm = async(url, data) => {\n    const params = new URLSearchParams();\n    Object.entries(data).forEach(([key, value]) => {\n        params.append(key, value);\n    });\n\n    const response = await fetch(url, {\n        method: 'POST',\n        headers: {'Content-Type': 'application/x-www-form-urlencoded'},\n        body: params.toString(),\n    });\n\n    return response.json();\n};\n\n/**\n * Initialize the connection flow (get a token).\n *\n * @param {string} connectUrl URL to connect.php\n * @param {string} sesskey Moodle session key\n * @returns {Promise<Object>} Response with token or error\n */\nexport const initConnection = async(connectUrl, sesskey) => {\n    return postForm(connectUrl, {action: 'init', sesskey});\n};\n\n/**\n * Poll the MoodleConnect API for connection status.\n *\n * @param {string} apiUrl MoodleConnect API URL\n * @param {string} token Connection token\n * @returns {Promise<Object>} Status response\n */\nexport const pollConnectionStatus = async(apiUrl, token) => {\n    const response = await fetch(`${apiUrl}/connect/status?token=${encodeURIComponent(token)}`);\n    return response.json();\n};\n\n/**\n * Save credentials to Moodle settings.\n *\n * @param {string} saveUrl URL to ajax_save.php\n * @param {string} sesskey Moodle session key\n * @param {string} siteKey The site key\n * @param {string} siteSecret The site secret\n * @returns {Promise<Object>} Response with success status\n */\nexport const saveCredentials = async(saveUrl, sesskey, siteKey, siteSecret) => {\n    return postForm(saveUrl, {\n        action: 'save',\n        sesskey,\n        siteKey: siteKey,\n        siteSecret: siteSecret,\n    });\n};\n\n/**\n * Get connection status from the backend.\n *\n * @param {string} syncUrl URL to sync_schema.php\n * @param {string} sesskey Moodle session key\n * @returns {Promise<Object>} Status response\n */\nexport const getConnectionStatus = async(syncUrl, sesskey) => {\n    return postForm(syncUrl, {action: 'status', sesskey});\n};\n\n/**\n * Save settings via AJAX.\n *\n * @param {string} ajaxSaveUrl URL to ajax_save.php\n * @param {string} sesskey Moodle session key\n * @param {Object} values Form values to save\n * @returns {Promise<Object>} Response with success status\n */\nexport const saveSettings = async(ajaxSaveUrl, sesskey, values) => {\n    return postForm(ajaxSaveUrl, {action: 'save', sesskey, ...values});\n};\n\n/**\n * Sync events to MoodleConnect.\n *\n * @param {string} syncUrl URL to sync_schema.php\n * @param {string} sesskey Moodle session key\n * @returns {Promise<Object>} Response with success status and event count\n */\nexport const syncEvents = async(syncUrl, sesskey) => {\n    return postForm(syncUrl, {action: 'sync', sesskey});\n};\n"],"names":["postForm","async","url","data","params","URLSearchParams","Object","entries","forEach","_ref","key","value","append","fetch","method","headers","body","toString","json","connectUrl","sesskey","action","apiUrl","token","encodeURIComponent","saveUrl","siteKey","siteSecret","syncUrl","ajaxSaveUrl","values"],"mappings":";;;;;;;;MAeMA,SAAWC,MAAMC,IAAKC,cAClBC,OAAS,IAAIC,gBACnBC,OAAOC,QAAQJ,MAAMK,SAAQC,WAAEC,IAAKC,YAChCP,OAAOQ,OAAOF,IAAKC,uBAGAE,MAAMX,IAAK,CAC9BY,OAAQ,OACRC,QAAS,gBAAiB,qCAC1BC,KAAMZ,OAAOa,cAGDC,gCAUUjB,MAAMkB,WAAYC,UACrCpB,SAASmB,WAAY,CAACE,OAAQ,OAAQD,QAAAA,wCAUbnB,MAAMqB,OAAQC,eACvBV,gBAASS,wCAA+BE,mBAAmBD,UAClEL,gCAYWjB,MAAMwB,QAASL,QAASM,QAASC,aACrD3B,SAASyB,QAAS,CACrBJ,OAAQ,OACRD,QAAAA,QACAM,QAASA,QACTC,WAAYA,0CAWe1B,MAAM2B,QAASR,UACvCpB,SAAS4B,QAAS,CAACP,OAAQ,SAAUD,QAAAA,gCAWpBnB,MAAM4B,YAAaT,QAASU,SAC7C9B,SAAS6B,YAAa,CAACR,OAAQ,OAAQD,QAAAA,WAAYU,6BAUpC7B,MAAM2B,QAASR,UAC9BpB,SAAS4B,QAAS,CAACP,OAAQ,OAAQD,QAAAA"}